name: push-version
on:
  push:
    tags:
      - '[0-9]+.[0-9]+.[0-9]+'
permissions:
  contents: write
env:
  GITHUB_TOKEN: ${{ secrets.WRITABLE_GITHUB_TOKEN }}
jobs:
  commit-and-push-version:
    runs-on: ubuntu-latest
    concurrency:
      group: commit-and-push-version
      cancel-in-progress: false
    steps:
      - name: checkout
        uses: actions/checkout@main
        with:
          ref: main
          fetch-depth: 1

      - name: Get tag
        id: tag
        run: echo "tag=${GITHUB_REF#refs/tags/}" >> $GITHUB_OUTPUT

      - name: Update version of package.json
        run: |
          jq '.version = "${{ steps.tag.outputs.tag }}"' package.json > package.json.tmp
          mv package.json.tmp package.json

      - name: Update VITE_PRODUCT_VERSION of .env
        run: sed -i 's/VITE_PRODUCT_VERSION=.*/VITE_PRODUCT_VERSION=${{ steps.tag.outputs.tag }}/' .env

      - name: Commit and push
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: ⬆️Update version (package.json, .env) to ${{ steps.tag.outputs.tag }}
          branch: main
